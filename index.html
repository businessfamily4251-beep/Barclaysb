import React, { useState, useEffect } from 'react';
import { 
  Bell, LogOut, Home, ArrowRightLeft, CreditCard, X, 
  Landmark, CheckCircle, Settings, TrendingUp, Download, 
  Eye, EyeOff, Mail, Phone, ChevronRight, AlertCircle,
  ArrowUpRight, Send
} from 'lucide-react';

const DATA = {
    user: {
        name: "Monique Abillard",
        loginId: "7897620168",
        password: "548521"
    },
    balance: 376000,
    contact: {
        email: "serviceclients@mail.com",
        phone: "+33 6 44 67 29 29"
    }
};

const formatEuro = (val) => new Intl.NumberFormat('fr-FR', { style: 'currency', currency: 'EUR' }).format(val);

const SuccessToast = ({ message, onClose }) => {
    useEffect(() => {
        const timer = setTimeout(onClose, 3000);
        return () => clearTimeout(timer);
    }, [onClose]);
    return (
        <div className="fixed bottom-8 left-1/2 -translate-x-1/2 z-50 animate-bounce">
            <div className="flex items-center gap-3 bg-emerald-600 text-white p-4 rounded-2xl shadow-xl">
                <CheckCircle className="w-5 h-5" />
                <span className="font-bold">{message}</span>
            </div>
        </div>
    );
};

export default function App() {
    const [isAuth, setIsAuth] = useState(false);
    const [view, setView] = useState('home');
    const [solde, setSolde] = useState(DATA.balance);
    const [showSolde, setShowSolde] = useState(true);
    const [notif, setNotif] = useState(true);
    const [msg, setMsg] = useState(null);
    const [loading, setLoading] = useState(false);

    const [txs, setTxs] = useState([
        { id: 'TX-99281', date: '08/12/2025', label: 'Blockchain Central', amount: 376000, type: 'plus' }
    ]);

    const onLogin = (e) => {
        e.preventDefault();
        const d = new FormData(e.target);
        if (d.get('uid') === DATA.user.loginId && d.get('pwd') === DATA.user.password) {
            setIsAuth(true);
        } else {
            setMsg("Accès refusé");
        }
    };

    const onTransfer = (e) => {
        e.preventDefault();
        const d = new FormData(e.target);
        const amt = parseFloat(d.get('amt'));
        if (amt > solde) return setMsg("Fonds insuffisants");
        
        setLoading(true);
        setTimeout(() => {
            setSolde(s => s - amt);
            setTxs([{ id: 'TX-'+Math.random().toString(36).substr(2, 5).toUpperCase(), date: new Date().toLocaleDateString(), label: d.get('to'), amount: amt, type: 'minus' }, ...txs]);
            setMsg("Transfert validé");
            setLoading(false);
            setView('home');
        }, 1200);
    };

    if (!isAuth) {
        return (
            <div className="min-h-screen bg-slate-50 flex items-center justify-center p-6">
                <div className="bg-white w-full max-w-md rounded-[2.5rem] shadow-2xl border border-slate-100 overflow-hidden">
                    <div className="bg-sky-600 p-10 text-center text-white">
                        <Landmark className="mx-auto mb-4 w-12 h-12" />
                        <h1 className="text-3xl font-black tracking-tighter">BARCLAYS</h1>
                        <p className="text-sky-100 text-sm mt-2">Authentification Sécurisée</p>
                    </div>
                    <form onSubmit={onLogin} className="p-10 space-y-5">
                        <div className="space-y-2">
                            <label className="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-1">Identifiant</label>
                            <input name="uid" type="text" className="w-full p-4 bg-slate-50 rounded-2xl border-none outline-none focus:ring-2 focus:ring-sky-500 transition-all" required />
                        </div>
                        <div className="space-y-2">
                            <label className="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-1">Mot de passe</label>
                            <input name="pwd" type="password" className="w-full p-4 bg-slate-50 rounded-2xl border-none outline-none focus:ring-2 focus:ring-sky-500 transition-all" required />
                        </div>
                        <button type="submit" className="w-full bg-sky-600 text-white p-5 rounded-2xl font-black hover:bg-sky-700 shadow-lg shadow-sky-200 active:scale-95 transition-all">ACCÉDER</button>
                    </form>
                </div>
                {msg && <SuccessToast message={msg} onClose={() => setMsg(null)} />}
            </div>
        );
    }

    return (
        <div className="min-h-screen bg-slate-50 flex flex-col md:flex-row text-slate-900 font-sans">
            {/* Sidebar Desktop */}
            <nav className="hidden md:flex flex-col w-72 bg-white border-r border-slate-100 p-8 space-y-10">
                <div className="flex items-center gap-3 text-sky-600">
                    <Landmark size={36} />
                    <span className="font-black text-2xl tracking-tighter">BARCLAYS</span>
                </div>
                <div className="space-y-3">
                    {[{id:'home', label:'Synthèse', icon:Home}, {id:'send', label:'Virements', icon:ArrowRightLeft}, {id:'card', label:'Cartes', icon:CreditCard}].map(i => (
                        <button key={i.id} onClick={() => setView(i.id)} className={`flex items-center gap-4 w-full p-4 rounded-2xl font-bold transition-all ${view === i.id ? 'bg-sky-50 text-sky-600' : 'text-slate-400 hover:bg-slate-50'}`}>
                            <i.icon size={22} /> {i.label}
                        </button>
                    ))}
                </div>
                <button onClick={() => setIsAuth(false)} className="mt-auto flex items-center gap-4 p-4 text-red-500 font-bold hover:bg-red-50 rounded-2xl transition-all">
                    <LogOut size={22} /> Quitter
                </button>
            </nav>

            {/* Content Area */}
            <main className="flex-1 flex flex-col h-screen overflow-hidden">
                <header className="bg-white p-6 border-b border-slate-100 flex justify-between items-center shrink-0">
                    <div>
                        <h2 className="font-black text-xl text-slate-800 tracking-tight">{DATA.user.name}</h2>
                        <p className="text-[10px] text-slate-400 font-bold uppercase">Compte Premier</p>
                    </div>
                    <div className="flex items-center gap-4">
                        <div className="w-10 h-10 bg-sky-600 rounded-full flex items-center justify-center text-white font-bold shadow-md shadow-sky-100">MA</div>
                    </div>
                </header>

                <div className="flex-1 overflow-y-auto p-6 md:p-10 space-y-8">
                    {view === 'home' ? (
                        <div className="max-w-4xl mx-auto space-y-8">
                            {/* Solde Card */}
                            <div className="bg-gradient-to-br from-sky-600 to-sky-900 rounded-[2.5rem] p-10 text-white shadow-2xl relative overflow-hidden">
                                <div className="relative z-10 space-y-8">
                                    <div className="flex justify-between items-start">
                                        <div>
                                            <p className="text-sky-200 text-xs font-bold uppercase tracking-widest mb-2">Solde disponible</p>
                                            <div className="flex items-center gap-5">
                                                <h3 className="text-5xl font-black tracking-tighter">{showSolde ? formatEuro(solde) : '•••••• €'}</h3>
                                                <button onClick={() => setShowSolde(!showSolde)} className="bg-white/10 p-2 rounded-xl hover:bg-white/20 transition-all">
                                                    {showSolde ? <EyeOff size={20}/> : <Eye size={20}/>}
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <div className="grid grid-cols-2 gap-4">
                                        <div className="bg-white/5 border border-white/10 p-4 rounded-2xl backdrop-blur-md">
                                            <p className="text-[10px] uppercase font-bold text-sky-200 mb-1">Dépenses</p>
                                            <p className="font-bold text-lg">{formatEuro(3240)}</p>
                                        </div>
                                        <div className="bg-white/5 border border-white/10 p-4 rounded-2xl backdrop-blur-md">
                                            <p className="text-[10px] uppercase font-bold text-sky-200 mb-1">Revenus</p>
                                            <p className="font-bold text-lg text-emerald-400">+{formatEuro(376000)}</p>
                                        </div>
                                    </div>
                                </div>
                                <div className="absolute top-0 right-0 w-64 h-64 bg-white/5 rounded-full blur-3xl -mr-20 -mt-20"></div>
                            </div>

                            {/* Alerte */}
                            {notif && (
                                <div className="bg-amber-50 border border-amber-100 p-6 rounded-3xl flex gap-5 relative">
                                    <button onClick={()=>setNotif(false)} className="absolute top-4 right-4 text-amber-300 hover:text-amber-500"><X size={18}/></button>
                                    <div className="bg-amber-500 p-3 rounded-2xl h-fit text-white shadow-lg shadow-amber-200"><AlertCircle/></div>
                                    <div className="text-sm text-amber-800 leading-relaxed font-medium">
                                        <strong className="block mb-1 text-amber-900 uppercase text-[10px] tracking-widest">Notification Système</strong>
                                        Votre transfert d'actifs numériques de 376 000,00 € a été centralisé. Les fonds sont disponibles.
                                    </div>
                                </div>
                            )}

                            {/* Transactions */}
                            <div className="bg-white rounded-[2.5rem] p-8 shadow-sm border border-slate-100">
                                <h4 className="font-black text-xl mb-6 flex items-center gap-3">Historique <span className="bg-slate-100 text-slate-400 text-xs px-3 py-1 rounded-full">{txs.length}</span></h4>
                                <div className="space-y-2">
                                    {txs.map(t => (
                                        <div key={t.id} className="flex items-center justify-between p-5 hover:bg-slate-50 rounded-2xl transition-all border border-transparent hover:border-slate-100 group">
                                            <div className="flex items-center gap-5">
                                                <div className={`w-12 h-12 rounded-2xl flex items-center justify-center ${t.type === 'plus' ? 'bg-emerald-50 text-emerald-600' : 'bg-slate-50 text-slate-600'}`}>
                                                    {t.type === 'plus' ? <TrendingUp size={24}/> : <ArrowUpRight size={24}/>}
                                                </div>
                                                <div>
                                                    <p className="font-bold text-slate-800">{t.label}</p>
                                                    <p className="text-[10px] text-slate-400 font-bold uppercase">{t.date} • {t.id}</p>
                                                </div>
                                            </div>
                                            <p className={`font-black text-lg ${t.type === 'plus' ? 'text-emerald-500' : 'text-slate-900'}`}>
                                                {t.type === 'plus' ? '+' : '-'} {formatEuro(t.amount)}
                                            </p>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>
                    ) : (
                        <div className="max-w-xl mx-auto animate-in fade-in slide-in-from-bottom-5">
                            <h3 className="text-2xl font-black mb-8 flex items-center gap-4"><ArrowRightLeft className="text-sky-600"/> Nouveau Virement</h3>
                            <form onSubmit={onTransfer} className="bg-white p-10 rounded-[2.5rem] shadow-sm border border-slate-100 space-y-6">
                                <div className="space-y-2">
                                    <label className="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-1">Destinataire</label>
                                    <input name="to" type="text" placeholder="Nom ou IBAN" className="w-full p-4 bg-slate-50 rounded-2xl outline-none focus:ring-2 focus:ring-sky-500 transition-all" required />
                                </div>
                                <div className="space-y-2">
                                    <label className="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-1">Montant du transfert</label>
                                    <input name="amt" type="number" placeholder="0.00" className="w-full p-6 bg-slate-50 rounded-2xl outline-none focus:ring-2 focus:ring-sky-500 transition-all text-2xl font-black" required />
                                </div>
                                <button disabled={loading} className="w-full bg-sky-600 text-white p-5 rounded-2xl font-black flex items-center justify-center gap-3 shadow-lg shadow-sky-100 disabled:opacity-50">
                                    {loading ? "Vérification..." : <><Send size={20}/> VALIDER LE VIREMENT</>}
                                </button>
                            </form>
                        </div>
                    )}
                </div>

                {/* Mobile Tab Bar */}
                <nav className="md:hidden bg-white border-t border-slate-100 p-4 flex justify-around">
                    {[{id:'home', icon:Home}, {id:'send', icon:ArrowRightLeft}, {id:'card', icon:CreditCard}, {id:'logout', icon:LogOut}].map(i => (
                        <button key={i.id} onClick={() => i.id === 'logout' ? setIsAuth(false) : setView(i.id)} className={`p-4 rounded-2xl transition-all ${view === i.id ? 'bg-sky-600 text-white shadow-lg' : 'text-slate-400'}`}>
                            <i.icon size={24} />
                        </button>
                    ))}
                </nav>
            </main>

            {msg && <SuccessToast message={msg} onClose={() => setMsg(null)} />}
        </div>
    );
}